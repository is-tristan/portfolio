---
// @ts-ignore
import menu from "../data/menu.json"
const logo =
	'<svg width="40" height="40" viewBox="0 0 64 64" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M12.4387 64L0 18.2857H9.46471L20.291 60.7857L16.9902 60.9286L32.2747 5H32.5379L47.1488 60.9286L43.848 60.7857L54.6743 18.2857H64L51.7003 64H40.9566L30.367 25.5H33.772L23.1824 64H12.4387Z" /> <path d="M0 0H64V9.66667H0V0Z" /> </svg>'
const gitHubIcon =
	'<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>'
---

<header id="header" class="header">
	<div class="container headerContainer">
		<div class="logo">
			<a href="/#" set:html={logo} aria-label="Go to home page" />
		</div>
		<div class="headerActions">
			<nav class="headerNav desktopNav hidden-s hidden-m">
				{
					menu.map((item: { label: string; href: string }) => (
						<a href={item.href} class="headerNavItem" data-section={item.label?.toLowerCase().replace(/ /g, "-").replace(".", "")}>
							{item.label}
						</a>
					))
				}
			</nav>
			<a href="https://github.com/is-tristan" target="_blank" class="btn">
				<div class="icon" set:html={gitHubIcon} />
				<span>GitHub</span>
			</a>
			<div class="mobileMenuBtn hidden-l hidden-xl">
				<span></span>
				<span></span>
			</div>
		</div>
	</div>
</header>

<script>
	const headerScroll = () => {
		const header = document.getElementById("header")
		if (!header) return
		const scrollPosition = window.scrollY

		if (scrollPosition > 32) {
			header.classList.add("active")
		} else {
			header.classList.remove("active")
		}

		requestAnimationFrame(headerScroll)
	}

	const setupSectionObserver = () => {
		const desktopNav = document.querySelector(".desktopNav")
		if (!desktopNav) return
		const navLinks = desktopNav.querySelectorAll(".headerNavItem")
		if (navLinks.length === 0) return

		const sectionToLink = new Map<Element, Element>()
		const observedSections: Element[] = []

		navLinks.forEach((link) => {
			const sectionId = link.getAttribute("data-section")
			if (!sectionId) return
			const section = document.getElementById(sectionId)
			if (!section) return
			sectionToLink.set(section, link)
			observedSections.push(section)
		})

		if (observedSections.length === 0) return

		const observer = new IntersectionObserver(
			(entries) => {
				entries.forEach((entry) => {
					const link = sectionToLink.get(entry.target)
					if (!link) return
					if (entry.isIntersecting) {
						navLinks.forEach((l) => l.classList.remove("active"))
						link.classList.add("active")
					} else {
						link.classList.remove("active")
					}
				})
			},
			{
				root: null,
				rootMargin: "0px 0px -70% 0px",
				threshold: 0,
			}
		)

		observedSections.forEach((section) => observer.observe(section))
	}

	headerScroll()
	setupSectionObserver()
</script>
